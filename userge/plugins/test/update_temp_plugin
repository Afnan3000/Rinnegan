
import importlib
import os

from userge import userge, Message, Config


@userge.on_cmd(
    "uload",
    about={
        "header": "update temp plugin",
        "usage": "{tr}uload [reply to plugin file]",
    },
)
async def update_temp_plugin(message: Message):
    "update temp plugin"
    reply_ = message.reply_to_message
    if not reply_ or not reply_.document:
        return await message.edit("`Reply to plugin file...`", del_in=5)
    file_name = reply_.document.file_name
    if not file_name.endswith(".py") or not reply_.document.file_size < 2 ** 20:
        return await message.edit("`Reply to .py plugin file...`", del_in=5)
    if not os.path.isdir(Config.TMP_PATH):
        os.makedirs(Config.TMP_PATH)
    t_path = os.path.join(Config.TMP_PATH, file_name)
    importlib.invalidate_caches()